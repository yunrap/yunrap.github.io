---
title: Database-3. 
date: 2021-06-28 11:33:00
categories: [Language, Database]
tags: [Database]
---

# 뷰

하나의 가상테이블 이다.
SELECT 문으로 조회된값으로 가상의 VIEW를 만들어내는것이다.

```
GRANT CREATE VIEW TO SCOTT;  // icia_sys에서 입력

CREATE OR REPLACE VIEW v_emp as
SELECT EMPNO, ENAME, JOB, DEPTNO
FROM EMP
WHERE EMPNO = 7369;

SELECT *
FROM EMP_TEMP T, v_emp V
WHERE T.EMPNO  = V.EMPNO;
```

# 인덱스

데이터베이스 테이블에 있는 데이터를 빨리 찾기 위한 용도의 데이터베이스

프라이머리 키는 반드시 UNIQUE이다.

1. 유니크 인덱스
테이블에 하나 이상의 같은 데이터 값이 입력되는것을 막아줌

2. 비유일 인덱스

인덱스 관리 (USER_INDEXES, USER_IND_COLUMNS, USER_COL_COMMENTS)

```
--인덱스
SELECT * FROM USER_INDEXES;

--인덱스 네임기준
SELECT * FROM USER_IND_COLUMNS;

CREATE INDEX IDX_EMP_MGR_GRADE ON
EMP(MGR, GRADE);
```

3. 리빌드
해당 테이블이 빈번하게 일어날때 인덱스 리빌드를 해준다.

인덱스 사용시 주의사항
테이블 조회 속도를 향상시키기위한 용도로 너무 많은 인덱스는 피해야한다.
또한 인덱스 컬럼으로 컬럼의 중복을 최소화 해야함 

# 시퀀스

여러 사용자에게 유일한 값을 생성해 주는 오라클객체

cycle : 최대값까지 증가후 최소값으로 돌아가는 옵션

```
SELECT MAX(EMPNO) FROM EMP;

--시퀀스
CREATE SEQUENCE EMP_EMPNO_SEQ
START WITH 7935
INCREMENT BY 1
MINVALUE 1
MAXVALUE 9999
NOCYCLE
NOCACHE;

SELECT EMP_EMPNO_SEQ.NEXTVAL --CURRVAL
FROM DUAL;



-- INSERT INTO EMP VALUES ((SELECT MAX(EMPNO)+1 FROM EMP))
-- 이방법이아닌
INSERT INTO EMP VALUES (EMP_EMPNO_SEQ.NEXTVAL, '김대경', '사원', 7902, TO_DATE('20210504', 'YYYYMMDD'), 1200, 0, 10, 1);

INSERT INTO EMP VALUES (EMP_EMPNO_SEQ.NEXTVAL, '윤예지', '사원', 7902, SYSDATE, 3000,0,20,5);

COMMIT;

```

BONUS (직원이름, 직업, 연봉, 보너스)

EMP         (직원번호, 직원이름, 직업, 매니저번호, 고용일자, 연봉, 보너스, 부서번호, 등급)
SALGRADE    (등급, 최저금액, 최고금액)
DEPT        (부서번호, 부서이름, 지역)
BONUS       (직원이름, 직업, 연봉, 보너스)

EMP 테이블 보너스삭제, 부서번호삭제, 등급삭제
BONUS 직원이름, 직업, 


EMP (직원번호, 직원이름, 직책, 매니저번호, 고용일자, 부서번호, 등급)
BONUS (급여액(년(6자리), 월, 직원번호), 보너스(년, 월, 직원번호))
DEPT (부서번호, 부서이름, 지역)
SALGRADE    (등급, 최저금액, 최고금액)


# 테이블만들기

```
--고정길이 CHAR
--가변길이 VARCHAR2
CREATE TABLE EMP(
    EMPNO NUMBER NOT NULL, 
    Ename VARCHAR2(10),
    Job VARCHAR2(9),
    Mgr NUMBER(4),
    Hiredate DATE,
    Deptno NUMBER(2) NOT NULL,
    GRADE NUMBER(1)
);

// 프라이머리 키 만들어주기
ALTER TABLE EMP ADD CONSTRAINT PK_EMPNO PRIMARY KEY(EMPNO);

// COMMENT 달아주기
COMMENT ON TABLE EMP IS '사원정보';

COMMENT ON COLUMN EMP.EMPNO IS '사원번호';
COMMENT ON COLUMN EMP.ENAME IS '사원이름';
COMMENT ON COLUMN EMP.JOB IS '직책';
COMMENT ON COLUMN EMP.MGR IS '매니저';
COMMENT ON COLUMN EMP.HIREDATE IS '입사일';
COMMENT ON COLUMN EMP.DEPTNO IS '부서번호';
COMMENT ON COLUMN EMP.GRADE IS '등급';

// DEPT 테이블 만들어주기
CREATE TABLE DEPT(
    DEPTNO NUMBER(2,0) NOT NULL,
    DNAME VARCHAR2(14),
    LOC VARCHAR2(13),
    CONSTRAINT PK_DEPT PRIMARY KEY(DEPTNO)
);

// DEPT 테이블 COMMENT달아주기
COMMENT ON TABLE DEPT IS '부서코드';

COMMENT ON COLUMN DEPT.DEPTNO IS '부서코드';
COMMENT ON COLUMN DEPT.DNAME IS '부서명';
COMMENT ON COLUMN DEPT.LOC IS '부서위치';


// SALGRADE 생성
CREATE TABLE SALGRADE
(
    GRADE NUMBER,
    LOSAL NUMBER,
    HISAL NUMBER
);

// SALGRADE 테이블 COMMENT 생성
COMMENT ON COLUMN SALGRADE.GRADE IS '등급';
COMMENT ON COLUMN SALGRADE.LOSAL IS '최저급여';
COMMENT ON COLUMN SALGRADE.HISAL IS '최고급여';

// SALGRADE PK 생성
ALTER TABLE SALGRADE ADD CONSTRAINT PK_GRADE PRIMARY KEY(GRADE);


// BONUS 테이블 생성
CREATE TABLE BONUS
(
    PAYMONTH CHAR(6) NOT NULL,
    EMPNO NUMBER(4) NOT NULL,
    SAL NUMBER(7,2),
    COMM NUMBER(7,2),
    CONSTRAINT PK_BONUS PRIMARY KEY(PAYMONTH, EMPNO)
)

// BONUS 테이블 COMMENT 생성
COMMENT ON TABLE BONUS IS '급여';
COMMENT ON COLUMN BONUS.PAYMONTH IS '급여년월';
COMMENT ON COLUMN BONUS.EMPNO IS '직원번호';
COMMENT ON COLUMN BONUS.SAL IS '급여액';
COMMENT ON COLUMN BONUS.COMM IS '보너스';

--FK
ALTER TABLE EMP
ADD CONSTRAINTS FK_MGR FOREIGN KEY(MGR)
REFERENCES EMP(EMPNO);

ALTER TABLE EMP
ADD CONSTRAINT FK_EMP_DEPTNO FOREIGN KEY(DEPTNO)
REFERENCES DEPT(DEPTNO);

ALTER TABLE EMP
ADD CONSTRAINT FK_EMP_GRADE FOREIGN KEY(GRADE)
REFERENCES SALGRADE(GRADE);

ALTER TABLE BONUS
ADD CONSTRAINT FK_BONUS_EMP FOREIGN KEY(EMPNO)
REFERENCES EMP(EMPNO);

```

점선과 실선차이

점선은 부모는 PK 자식은 속성
실선은 부모는 pk 자식도 pk


