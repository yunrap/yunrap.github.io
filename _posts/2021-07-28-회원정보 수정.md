---
title: spring_project-3. 스프링 프로젝트(회원정보 수정)
date: 2021-07-26 18:33:00
categories: [Project, spring_project]
tags: [spring_project]
---


# ioc 와 DI 개념 파악하기


## 리팩토링

내부 구조를 효율적으로 변경해서 코드를 재구성

```
@Controller
@RequstMapping(value = "/")
public class EmailController {
  @RequestMapping(value= "/sendEmail")
  @ResponseBody
  public String sendEmail() {
    EmailServiceClient emailServiceClient = new GmailServiceClinet();
    SendEmailRequest sendEmailRequest = generateEmailRequest();
    emailServiceClient.sendEmail(SendEmailRequest);
    return "Success";
  }
}
```

여기에 무슨문제점이있을까? 

이메일을 구성해서 전달하는 역활인데
emailServiceClient 의 특정 구현 클래스를 선택하고 생성하는 일은 또다른관심사이다.


## 관심사파악

```
public void sendEmail(@RequestParam(“to”) List<String> to, 
@RequestParam(“cc”) List<String> cc) { 
String subject = generateSubject(); // 제목 생성
String body = generateBody(); //내용 생성
Content subjectContent = new Content().withData(subject); 
Body bodyContent = new Body().withHtml(new Content().withData(body)); 
Message message = new Message().withSubject(subjectContent)
.withBody(bodyContent); 
Destination destination = new Destination(); //받는 사람 구성
if (CollectionUtils.isNotEmpty(to)) { 
destination.withToAddresses(to); 
} 
if (CollectionUtils.isNotEmpty(cc)) { 
destination.withCcAddresses(cc); 
} 
SendEmailRequest sendEmailRequest = new 
SendEmailRequest().withSource(source).withDestination(destination)
.withMessage(message);
EmailServiceClient emailServiceClient = new EmailServiceClient(); 
emailServiceClient.sendEmail(sendEmailRequest); //실제 이메일 발송
}
```

sendEmail함수에서는 순수하게 이메일 발송에만 전념하게 수정


```
public void sendEmail(SendEmailRequest sendEmailRequest) 
//구성된 이메일을 외부로부터 전달받음
EmailServiceClient emailServiceClient = new EmailServiceClient(); 
emailServiceClient.sendEmail(sendEmailRequest); //실제 이메일 발송
}
```

이런게 리팩토링이다

1. 내부 구조를 효율적으로 변경해서 코드를 재구성
2. 생산성 및 코드 품질 상승


# 객체의 제어권

```
@Controller
@RequestMapping(value = "/")
public class EmailController {
@RequestMapping(value = "/sendEmail")
@ResponseBody
  public String sendEmail() {
  EmailServiceClient emailServiceClient = new GmailServiceClient();
  SendEmailRequest sendEmailRequest = generateEmailRequest();
  emailServiceClient.sendEmail(sendEmailRequest);
  return "Success";
  }
}
```



# 회원정보 수정

1. 컨트롤러 등록
2. updateForm 화면 구현
3. 서비스 등록
4. xml 등록

원래순서는 xml부터  우선 이렇게 진행해본다

## 컨트롤러 등록

우선 컨트롤러를 통해 url을 매핑해준다

```
 //회원정보 수정
   @RequestMapping(value="/user/updateForm", method=RequestMethod.GET)
   public String UpdateForm(ModelMap model, HttpServletRequest request, HttpServletResponse response)
   {
	   String cokieUserId = CookieUtil.getHexValue(request, AUTH_COOKIE_NAME);
	   
	   User user = userService.userSelect(cokieUserId);
	   
	   model.addAttribute("user", user);
	   return "/user/updateForm";
   }
```

1. 쿠기정보를 가져와서
2. 쿠기아이디로 userSelcect를 해줘 user객체를 가져오고
3. user객체를 jsp화면에 model.addAttribute를 통해 user라는 이름으로 화면단에 넘겨준다
4. 그후 해당 url을 string으로 넘겨주면 된다





## updateForm 화면 구현

```
<%@page import="com.icia.web.model.User"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<%@ include file="/WEB-INF/views/include/head.jsp" %>
<script type="text/javascript">
$(document).ready(function() {

	$("#btnUpdate").on("click", function() {
		
		// 모든 공백 체크 정규식
		var emptCheck = /\s/g;
		// 영문 대소문자, 숫자로만 이루어진 4~12자리 정규식
		var idPwCheck = /^[a-zA-Z0-9]{4,12}$/;
				
		if($.trim($("#userPwd1").val()).length <= 0)
		{
			alert("비밀번호를 입력하세요.");
			$("#userPwd1").val("");
			$("#userPwd1").focus();
			return;
		}
		
		if (emptCheck.test($("#userPwd1").val())) 
		{
			alert("비밀번호는 공백을 포함할 수 없습니다.");
			$("#userPwd1").focus();
			return;
		}
		
		if (!idPwCheck.test($("#userPwd1").val())) 
		{
			alert("비밀번호는 영문 대소문자와 숫자로 4~12자리 입니다.");
			$("#userPwd1").focus();
			return;
		}
		
		if ($("#userPwd1").val() != $("#userPwd2").val()) 
		{
			alert("비밀번호가 일치하지 않습니다.");
			$("#userPwd2").focus();
			return;
		}
		
		if($.trim($("#userName").val()).length <= 0)
		{
			alert("사용자 이름을 입력하세요.");
			$("#userName").val("");
			$("#userName").focus();
			return;
		}
		
		if(!fn_validateEmail($("#userEmail").val()))
		{
			alert("사용자 이메일 형식이 올바르지 않습니다.");
			$("#userEmail").focus();
			return;	
		}
		
		$("#userPwd").val($("#userPwd1").val());
		
	});
});

function fn_validateEmail(value)
{
	var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
	
	return emailReg.test(value);
}
</script>
</head>
<body>
<%@ include file="/WEB-INF/views/include/navigation.jsp" %>
<div class="container">
    <div class="row mt-5">
    	<h1>회원정보수정</h1>
    </div>
    <div class="row mt-2">
        <div class="col-12">
            <form>
                <div class="form-group">
                    <label for="username">사용자 아이디</label>
                    ${user.userId}
                </div>
                <div class="form-group">
                    <label for="username">비밀번호</label>
                    <input type="password" class="form-control" id="userPwd1" name="userPwd1" value="${user.userPwd}" placeholder="비밀번호" maxlength="12" />
                </div>
                <div class="form-group">
                    <label for="username">비밀번호 확인</label>
                    <input type="password" class="form-control" id="userPwd2" name="userPwd2" value="${user.userPwd}"  placeholder="비밀번호 확인"                                      maxlength="12" />
                </div>
                <div class="form-group">
                    <label for="username">사용자 이름</label>
                    <input type="text" class="form-control" id="userName" name="userName" value="${user.userName}" placeholder="사용자 이름" maxlength="15" />
                </div>
                <div class="form-group">
                    <label for="username">사용자 이메일</label>
                    <input type="text" class="form-control" id="userEmail" name="userEmail" value="${user.userEmail}" placeholder="사용자 이메일"                                       maxlength="30" />
                </div>
                <input type="hidden" id="userId" name="userId" value="${user.userId}" />
                <input type="hidden" id="userPwd" name="userPwd" value="" />
                <button type="button" id="btnUpdate" class="btn btn-primary">수정</button>
            </form>
        </div>
    </div>
</div>
</body>
</html>	
```


여기서보면 user라는 객체를 사용하여 바로 view의 data로 전달할수있다는점이다

기존의 스프링을 사용하지않았을때는

```
UserDao userDao = new UserDao();
user = userDao.userSelect(cookieUserId);
```
화면단에서 이렇게 직접 user를 dao에서 가져와서 값을 전달해야했는데
model.addAttribute를 사용하여 스프링을 조건에서는 user객체만 선언해주면
바로 값을 가져올수있어 화면과 서비스인 즉 비즈니스로직의 분리가 가능해졌다는점이다



## 서비스 등록과 dao부분

service 부분
```
public User userSelect(String userId)
	{
		User user = null;
		
		try
		{
			user = userDao.userSelect(userId);
		}
		catch(Exception e)
		{
			logger.error("[UserService] userSelect Exception", e);
		}
		
		return user;
	}
```

dao 부분
```
public User userSelect(String userId);
```

dao부분 메소드명과 아래 xml의 id명이 같아야한다


## xml 등록

```
<select id="userSelect" parameterType="string" resultMap="userResultMap">
SELECT
    USER_ID,
    NVL(USER_PWD, '') AS USER_PWD,
    NVL(USER_NAME, '') AS USER_NAME,
    NVL(USER_EMAIL, '') AS USER_EMAIL,
    NVL(STATUS, 'N') AS STATUS,
    NVL(TO_CHAR(REG_DATE, 'YYYY.MM.DD HH24:MI:SS'), '') AS REG_DATE
FROM
    TBL_USER
WHERE
    USER_ID = #{value}
</select>
```

이렇게 구현하면 회원정보 수정창에 들어가서 로그인했던 그정보의 값들을 불러올수있는것
까지 구현을 하게된것이다

그다음엔 버튼을 누른후 정보 수정이 완료되어 디비수정된것까지 구현을 해보려한다



# 수정 버튼동작 구현






